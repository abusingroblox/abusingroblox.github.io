<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StreamVault</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { background: #0a0a0f; color: #fff; font-family: 'Outfit', sans-serif; min-height: 100vh; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #2a2a3e; border-radius: 3px; }
    .hide-scroll { overflow-x: auto; scrollbar-width: none; -ms-overflow-style: none; }
    .hide-scroll::-webkit-scrollbar { display: none; }

    @keyframes shiny {
      0%   { background-position: -200% center; }
      100% { background-position:  200% center; }
    }
    @keyframes heroFadeIn {
      from { opacity: 0; transform: scale(1.03); }
      to   { opacity: 1; transform: scale(1); }
    }
    @keyframes blobFloat {
      from { transform: translate(0, 0) scale(1); }
      to   { transform: translate(30px, -20px) scale(1.15); }
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .nav-btn { transition: all 0.2s; }
    .nav-btn:hover { background: rgba(229,9,20,0.15) !important; color: #fff !important; }

    .play-btn { transition: transform 0.2s, box-shadow 0.2s; }
    .play-btn:hover { transform: scale(1.04) !important; box-shadow: 0 0 50px rgba(229,9,20,0.6) !important; }

    .info-btn { transition: background 0.2s; }
    .info-btn:hover { background: rgba(255,255,255,0.18) !important; }

    .card-wrap { transition: transform 0.3s cubic-bezier(0.175,0.885,0.32,1.275), box-shadow 0.3s ease; }
    .card-wrap:hover { transform: scale(1.08) translateY(-6px) !important; box-shadow: 0 20px 60px rgba(0,0,0,0.7), 0 0 0 1px rgba(229,9,20,0.3) !important; z-index: 10 !important; }
    .card-wrap:hover .card-overlay { opacity: 1 !important; }
    .card-wrap:hover .card-border { opacity: 1 !important; }

    .scroll-arrow { transition: background 0.2s; }
    .scroll-arrow:hover { background: rgba(229,9,20,0.4) !important; }

    .ep-row { transition: background 0.2s, border-color 0.2s; }
    .ep-row:hover { background: rgba(229,9,20,0.08) !important; border-color: rgba(229,9,20,0.2) !important; }

    .anime-card { transition: all 0.2s; }
    .anime-card:hover { border-color: rgba(229,9,20,0.35) !important; background: #1a1a20 !important; transform: translateY(-3px) !important; box-shadow: 0 12px 30px rgba(0,0,0,0.4) !important; }

    .tab-active-indicator { animation: fadeUp 0.3s ease; }

    input, select, button { font-family: 'Outfit', sans-serif; }

    .detail-modal { scrollbar-width: thin; scrollbar-color: #333 transparent; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const KEY = "375ece7e4f6b51e8df7c8db037bb11eb";
    const IMG = (path, size = "w500") => path ? `https://image.tmdb.org/t/p/${size}${path}` : null;

    const tmdb = async (endpoint) => {
      const sep = endpoint.includes("?") ? "&" : "?";
      const url = `https://api.themoviedb.org/3${endpoint}${sep}api_key=${KEY}`;
      try {
        const r = await fetch(url);
        if (!r.ok) throw new Error("direct failed");
        return r.json();
      } catch {
        const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
        const r = await fetch(proxy);
        return r.json();
      }
    };

    /* ‚îÄ‚îÄ Navbar ‚îÄ‚îÄ */
    function Navbar({ query, setQuery, activeTab, setActiveTab, scrolled }) {
      return (
        <nav style={{
          position: "fixed", top: 0, left: 0, right: 0, zIndex: 100,
          padding: "0 48px", height: 64,
          display: "flex", alignItems: "center", gap: 32,
          background: scrolled ? "rgba(10,10,15,0.95)" : "linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 100%)",
          backdropFilter: scrolled ? "blur(12px)" : "none",
          borderBottom: scrolled ? "1px solid rgba(255,255,255,0.06)" : "none",
          transition: "all 0.3s ease",
        }}>
          <div style={{ fontSize: 26, fontFamily: "'Bebas Neue', cursive", letterSpacing: 5, color: "#fff", userSelect: "none" }}>
            STREAM<span style={{ color: "#e50914" }}>VAULT</span>
          </div>

          <div style={{ display: "flex", gap: 4, flex: 1 }}>
            {["Movies", "TV Shows", "Anime"].map(tab => (
              <button key={tab} className="nav-btn" onClick={() => setActiveTab(tab)} style={{
                background: activeTab === tab ? "rgba(229,9,20,0.15)" : "transparent",
                border: activeTab === tab ? "1px solid rgba(229,9,20,0.4)" : "1px solid transparent",
                borderRadius: 8, padding: "6px 16px",
                color: activeTab === tab ? "#fff" : "#888",
                fontSize: 13, fontWeight: activeTab === tab ? 600 : 400, cursor: "pointer",
              }}>{tab}</button>
            ))}
          </div>

          <div style={{
            display: "flex", alignItems: "center", gap: 10,
            background: "rgba(255,255,255,0.06)", border: "1px solid rgba(255,255,255,0.1)",
            borderRadius: 10, padding: "8px 14px",
          }}>
            <svg width="14" height="14" fill="none" stroke="#888" strokeWidth="2" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            <input value={query} onChange={e => setQuery(e.target.value)}
              placeholder="Search movies, shows..."
              style={{ background: "transparent", border: "none", outline: "none", color: "#fff", fontSize: 13, width: 200 }}
            />
          </div>
        </nav>
      );
    }

    /* ‚îÄ‚îÄ Hero ‚îÄ‚îÄ */
    function Hero({ items, onPlay, onInfo }) {
      const [idx, setIdx] = useState(0);
      const item = items[idx];

      useEffect(() => {
        const t = setTimeout(() => setIdx(i => (i + 1) % items.length), 7000);
        return () => clearTimeout(t);
      }, [idx, items.length]);

      if (!item) return null;

      return (
        <div style={{ position: "relative", height: "88vh", overflow: "hidden", background: "#0a0a0f" }}>
          {item.backdrop_path && (
            <img src={IMG(item.backdrop_path, "original")} alt="" style={{
              position: "absolute", inset: 0, width: "100%", height: "100%",
              objectFit: "cover", objectPosition: "center top",
              animation: "heroFadeIn 0.8s ease",
            }} />
          )}
          <div style={{ position: "absolute", inset: 0, background: "linear-gradient(to right, rgba(10,10,15,0.95) 0%, rgba(10,10,15,0.6) 45%, rgba(10,10,15,0.1) 100%)" }} />
          <div style={{ position: "absolute", bottom: 0, left: 0, right: 0, height: "50%", background: "linear-gradient(to top, #0a0a0f 0%, transparent 100%)" }} />

          <div style={{ position: "absolute", bottom: "18%", left: 48, maxWidth: 560, animation: "heroFadeIn 0.6s ease" }}>
            <div style={{
              display: "inline-flex", alignItems: "center", gap: 6,
              background: "rgba(229,9,20,0.15)", border: "1px solid rgba(229,9,20,0.4)",
              borderRadius: 20, padding: "4px 12px", fontSize: 11, color: "#e50914",
              fontWeight: 700, letterSpacing: 2, marginBottom: 16, textTransform: "uppercase",
            }}>‚ö° Featured</div>

            <h1 style={{
              fontFamily: "'Bebas Neue', cursive", fontSize: "clamp(3rem,5vw,5rem)",
              letterSpacing: 4, color: "#fff", margin: "0 0 14px", lineHeight: 1,
              textShadow: "0 4px 20px rgba(0,0,0,0.5)",
            }}>{item.title || item.name}</h1>

            <p style={{
              color: "rgba(255,255,255,0.75)", fontSize: 14, lineHeight: 1.7, marginBottom: 28,
              display: "-webkit-box", WebkitLineClamp: 3, WebkitBoxOrient: "vertical", overflow: "hidden",
            }}>{item.overview}</p>

            <div style={{ display: "flex", gap: 12, alignItems: "center" }}>
              <button className="play-btn" onClick={() => onPlay(item)} style={{
                display: "flex", alignItems: "center", gap: 10,
                background: "#e50914", border: "none", borderRadius: 10, padding: "14px 28px",
                color: "#fff", fontWeight: 700, fontSize: 15, cursor: "pointer",
                boxShadow: "0 0 30px rgba(229,9,20,0.4)",
              }}>
                <svg width="18" height="18" viewBox="0 0 24 24" fill="white"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                Play Now
              </button>
              <button className="info-btn" onClick={() => onInfo(item)} style={{
                display: "flex", alignItems: "center", gap: 10,
                background: "rgba(255,255,255,0.1)", border: "1px solid rgba(255,255,255,0.2)",
                borderRadius: 10, padding: "13px 24px", color: "#fff", fontWeight: 600,
                fontSize: 15, cursor: "pointer", backdropFilter: "blur(10px)",
              }}>
                <svg width="16" height="16" fill="none" stroke="white" strokeWidth="2" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/>
                </svg>
                More Info
              </button>
            </div>

            <div style={{ display: "flex", gap: 6, marginTop: 24 }}>
              {items.slice(0, 6).map((_, i) => (
                <div key={i} onClick={() => setIdx(i)} style={{
                  width: i === idx ? 24 : 6, height: 6, borderRadius: 3,
                  background: i === idx ? "#e50914" : "rgba(255,255,255,0.25)",
                  cursor: "pointer", transition: "all 0.3s ease",
                }} />
              ))}
            </div>
          </div>

          {item.vote_average && (
            <div style={{ position: "absolute", bottom: "18%", right: 48, textAlign: "center" }}>
              <div style={{ fontSize: 36, fontWeight: 800, color: "#fff" }}>{item.vote_average.toFixed(1)}</div>
              <div style={{ fontSize: 11, color: "#888", letterSpacing: 2, textTransform: "uppercase" }}>Rating</div>
            </div>
          )}
        </div>
      );
    }

    /* ‚îÄ‚îÄ Media Card ‚îÄ‚îÄ */
    function MediaCard({ item, onPlay, onInfo, type }) {
      return (
        <div className="card-wrap" style={{
          position: "relative", flexShrink: 0, width: 180,
          borderRadius: 12, overflow: "hidden", cursor: "pointer",
          boxShadow: "0 4px 20px rgba(0,0,0,0.4)",
        }}>
          <div style={{ aspectRatio: "2/3", background: "#1a1a2e", position: "relative" }}>
            {item.poster_path
              ? <img src={IMG(item.poster_path, "w342")} alt={item.title || item.name}
                  style={{ width: "100%", height: "100%", objectFit: "cover" }} />
              : <div style={{ width: "100%", height: "100%", display: "flex", alignItems: "center",
                  justifyContent: "center", color: "#444", fontSize: 12, textAlign: "center", padding: 16 }}>
                  {item.title || item.name}
                </div>
            }
            <div className="card-overlay" style={{
              position: "absolute", inset: 0, opacity: 0, transition: "opacity 0.3s ease",
              background: "linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.2) 60%, transparent 100%)",
              display: "flex", flexDirection: "column", justifyContent: "flex-end", padding: 14, gap: 8,
            }}>
              <div style={{ fontSize: 13, fontWeight: 700, color: "#fff", lineHeight: 1.3 }}>{item.title || item.name}</div>
              {item.vote_average && (
                <div style={{ display: "flex", alignItems: "center", gap: 4 }}>
                  <span style={{ color: "#ffc107", fontSize: 11 }}>‚òÖ</span>
                  <span style={{ color: "#ccc", fontSize: 11 }}>{item.vote_average.toFixed(1)}</span>
                </div>
              )}
              <div style={{ display: "flex", gap: 8, marginTop: 4 }}>
                <button onClick={e => { e.stopPropagation(); onPlay(item, type); }} style={{
                  flex: 1, background: "#e50914", border: "none", borderRadius: 7, padding: "8px 0",
                  color: "#fff", fontSize: 12, fontWeight: 700, cursor: "pointer",
                  display: "flex", alignItems: "center", justifyContent: "center", gap: 5,
                }}>
                  <svg width="10" height="10" viewBox="0 0 24 24" fill="white"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                  Play
                </button>
                <button onClick={e => { e.stopPropagation(); onInfo(item, type); }} style={{
                  background: "rgba(255,255,255,0.15)", border: "1px solid rgba(255,255,255,0.25)",
                  borderRadius: 7, padding: "8px 10px", color: "#fff", fontSize: 12, cursor: "pointer",
                }}>¬∑¬∑¬∑</button>
              </div>
            </div>
          </div>
          <div className="card-border" style={{
            position: "absolute", inset: 0, borderRadius: 12,
            border: "1px solid rgba(229,9,20,0.5)", opacity: 0,
            pointerEvents: "none", transition: "opacity 0.3s",
          }} />
        </div>
      );
    }

    /* ‚îÄ‚îÄ Media Row ‚îÄ‚îÄ */
    function MediaRow({ title, items, onPlay, onInfo, type }) {
      const scrollRef = useRef(null);
      const scroll = dir => scrollRef.current?.scrollBy({ left: dir * 600, behavior: "smooth" });
      if (!items?.length) return null;
      return (
        <div style={{ marginBottom: 40, position: "relative" }}>
          <h2 style={{ fontSize: 18, fontWeight: 700, color: "#fff", margin: "0 0 16px 48px",
            letterSpacing: 0.5, display: "flex", alignItems: "center", gap: 10 }}>
            <span style={{ width: 3, height: 18, background: "#e50914", borderRadius: 2, display: "inline-block" }}/>
            {title}
          </h2>
          <div style={{ position: "relative" }}>
            {["left","right"].map(dir => (
              <button key={dir} className="scroll-arrow" onClick={() => scroll(dir === "left" ? -1 : 1)} style={{
                position: "absolute", [dir]: 0, top: "50%", transform: "translateY(-50%)", zIndex: 5,
                background: "rgba(10,10,15,0.85)", border: "1px solid rgba(255,255,255,0.1)",
                borderRadius: dir === "left" ? "0 8px 8px 0" : "8px 0 0 8px",
                width: 40, height: 80, color: "#fff", cursor: "pointer",
                display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22,
              }}>{dir === "left" ? "‚Äπ" : "‚Ä∫"}</button>
            ))}
            <div ref={scrollRef} className="hide-scroll" style={{ display: "flex", gap: 14, padding: "8px 48px 16px" }}>
              {items.map(item => (
                <MediaCard key={item.id} item={item} onPlay={onPlay} onInfo={onInfo}
                  type={type || (item.first_air_date ? "tv" : "movie")} />
              ))}
            </div>
          </div>
        </div>
      );
    }

    /* ‚îÄ‚îÄ Player Modal ‚îÄ‚îÄ */
    function PlayerModal({ media, type, season, episode, onClose }) {
      const src = type === "tv"
        ? `https://vidlink.pro/tv/${media.id}/${season}/${episode}`
        : type === "anime"
        ? `https://vidlink.pro/anime/${media.id}/${episode}/sub`
        : `https://vidlink.pro/movie/${media.id}`;

      return (
        <div style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,0.95)", zIndex: 200,
          display: "flex", flexDirection: "column" }}>
          <div style={{
            display: "flex", alignItems: "center", justifyContent: "space-between",
            padding: "16px 24px", background: "rgba(10,10,15,0.9)",
            borderBottom: "1px solid rgba(255,255,255,0.06)",
          }}>
            <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
              <button onClick={onClose} style={{
                background: "rgba(255,255,255,0.08)", border: "1px solid rgba(255,255,255,0.12)",
                borderRadius: 8, padding: "8px 14px", color: "#fff", cursor: "pointer", fontSize: 13,
                display: "flex", alignItems: "center", gap: 6,
              }}>‚Üê Back</button>
              <div>
                <div style={{ color: "#fff", fontWeight: 700, fontSize: 15 }}>{media.title || media.name}</div>
                {type === "tv" && <div style={{ color: "#888", fontSize: 12 }}>Season {season} ¬∑ Episode {episode}</div>}
              </div>
            </div>
            <div style={{ fontFamily: "'Bebas Neue', cursive", fontSize: 20, letterSpacing: 4 }}>
              STREAM<span style={{ color: "#e50914" }}>VAULT</span>
            </div>
          </div>
          <div style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center" }}>
            <iframe src={src} frameBorder="0" allowFullScreen allow="autoplay; fullscreen"
              style={{ width: "100%", height: "100%", maxWidth: 1400, borderRadius: 12,
                border: "1px solid rgba(255,255,255,0.06)" }} />
          </div>
        </div>
      );
    }

    /* ‚îÄ‚îÄ Detail Modal ‚îÄ‚îÄ */
    function DetailModal({ media, type, onPlay, onClose }) {
      const [details, setDetails] = useState(null);
      const [season, setSeason] = useState(1);
      const [episode, setEpisode] = useState(1);
      const [episodes, setEpisodes] = useState([]);

      useEffect(() => {
        tmdb(`/${type === "tv" ? "tv" : "movie"}/${media.id}`).then(setDetails).catch(() => {});
      }, [media.id, type]);

      useEffect(() => {
        if (type === "tv") {
          tmdb(`/tv/${media.id}/season/${season}`)
            .then(d => setEpisodes(d.episodes || []))
            .catch(() => {});
        }
      }, [media.id, type, season]);

      const genres = details?.genres?.map(g => g.name) || [];
      const runtime = details?.runtime
        ? `${Math.floor(details.runtime / 60)}h ${details.runtime % 60}m`
        : details?.episode_run_time?.[0] ? `${details.episode_run_time[0]}m/ep` : null;

      return (
        <div onClick={onClose} style={{
          position: "fixed", inset: 0, background: "rgba(0,0,0,0.75)", zIndex: 150,
          display: "flex", alignItems: "center", justifyContent: "center",
          padding: 24, backdropFilter: "blur(6px)",
        }}>
          <div className="detail-modal" onClick={e => e.stopPropagation()} style={{
            background: "#141418", border: "1px solid rgba(255,255,255,0.08)",
            borderRadius: 20, width: "100%", maxWidth: 900,
            maxHeight: "90vh", overflow: "auto", position: "relative",
          }}>
            {/* backdrop */}
            <div style={{ position: "relative", height: 320, overflow: "hidden", borderRadius: "20px 20px 0 0" }}>
              {media.backdrop_path
                ? <img src={IMG(media.backdrop_path, "w1280")} alt=""
                    style={{ width: "100%", height: "100%", objectFit: "cover", objectPosition: "center top" }} />
                : <div style={{ width: "100%", height: "100%", background: "#1a1a2e" }} />
              }
              <div style={{ position: "absolute", inset: 0, background: "linear-gradient(to top, #141418 0%, rgba(20,20,24,0.4) 60%, transparent 100%)" }} />
              <button onClick={onClose} style={{
                position: "absolute", top: 16, right: 16, background: "rgba(0,0,0,0.6)",
                border: "1px solid rgba(255,255,255,0.15)", borderRadius: "50%",
                width: 36, height: 36, color: "#fff", cursor: "pointer", fontSize: 20,
                display: "flex", alignItems: "center", justifyContent: "center",
              }}>√ó</button>
            </div>

            <div style={{ padding: "0 32px 32px" }}>
              <div style={{ display: "flex", gap: 24, alignItems: "flex-start", flexWrap: "wrap" }}>
                {media.poster_path && (
                  <img src={IMG(media.poster_path, "w342")} alt="" style={{
                    width: 160, borderRadius: 12, marginTop: -70, flexShrink: 0,
                    border: "3px solid rgba(255,255,255,0.08)", boxShadow: "0 20px 40px rgba(0,0,0,0.5)",
                  }} />
                )}
                <div style={{ flex: 1, minWidth: 200, paddingTop: 16 }}>
                  <h2 style={{ fontFamily: "'Bebas Neue', cursive", fontSize: 38, letterSpacing: 3, color: "#fff", marginBottom: 8 }}>
                    {media.title || media.name}
                  </h2>
                  <div style={{ display: "flex", flexWrap: "wrap", gap: 10, alignItems: "center", marginBottom: 16 }}>
                    {media.vote_average && (
                      <span style={{ background: "rgba(255,193,7,0.15)", border: "1px solid rgba(255,193,7,0.3)",
                        borderRadius: 6, padding: "3px 10px", color: "#ffc107", fontSize: 12, fontWeight: 700 }}>
                        ‚òÖ {media.vote_average.toFixed(1)}
                      </span>
                    )}
                    {(media.release_date || media.first_air_date) && (
                      <span style={{ color: "#888", fontSize: 13 }}>{(media.release_date || media.first_air_date)?.split("-")[0]}</span>
                    )}
                    {runtime && (
                      <span style={{ background: "rgba(255,255,255,0.07)", borderRadius: 6, padding: "3px 10px", color: "#aaa", fontSize: 12 }}>{runtime}</span>
                    )}
                    {genres.slice(0, 3).map(g => (
                      <span key={g} style={{ background: "rgba(229,9,20,0.1)", border: "1px solid rgba(229,9,20,0.2)",
                        borderRadius: 6, padding: "3px 10px", color: "#e50914", fontSize: 12 }}>{g}</span>
                    ))}
                  </div>
                  <p style={{ color: "#aaa", fontSize: 14, lineHeight: 1.7, marginBottom: 20 }}>{media.overview}</p>

                  {type === "tv" && (
                    <div style={{ display: "flex", gap: 10, marginBottom: 20, flexWrap: "wrap" }}>
                      <div>
                        <label style={{ color: "#666", fontSize: 11, textTransform: "uppercase", letterSpacing: 1, display: "block", marginBottom: 6 }}>Season</label>
                        <select value={season} onChange={e => setSeason(Number(e.target.value))} style={{
                          background: "#1a1a2e", border: "1px solid rgba(255,255,255,0.1)", borderRadius: 8,
                          padding: "8px 12px", color: "#fff", fontSize: 13, cursor: "pointer",
                        }}>
                          {Array.from({ length: details?.number_of_seasons || 1 }, (_, i) => i + 1).map(s => (
                            <option key={s} value={s}>Season {s}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label style={{ color: "#666", fontSize: 11, textTransform: "uppercase", letterSpacing: 1, display: "block", marginBottom: 6 }}>Episode</label>
                        <select value={episode} onChange={e => setEpisode(Number(e.target.value))} style={{
                          background: "#1a1a2e", border: "1px solid rgba(255,255,255,0.1)", borderRadius: 8,
                          padding: "8px 12px", color: "#fff", fontSize: 13, cursor: "pointer",
                        }}>
                          {(episodes.length
                            ? episodes
                            : Array.from({ length: 20 }, (_, i) => ({ episode_number: i + 1, name: `Episode ${i + 1}` }))
                          ).map(ep => (
                            <option key={ep.episode_number} value={ep.episode_number}>
                              {ep.episode_number}. {ep.name || `Episode ${ep.episode_number}`}
                            </option>
                          ))}
                        </select>
                      </div>
                    </div>
                  )}

                  <button className="play-btn" onClick={() => onPlay(media, type, season, episode)} style={{
                    display: "flex", alignItems: "center", gap: 10,
                    background: "#e50914", border: "none", borderRadius: 10, padding: "14px 32px",
                    color: "#fff", fontWeight: 700, fontSize: 15, cursor: "pointer",
                    boxShadow: "0 0 30px rgba(229,9,20,0.35)",
                  }}>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    {type === "tv" ? `Watch S${season}E${episode}` : "Watch Now"}
                  </button>
                </div>
              </div>

              {type === "tv" && episodes.length > 0 && (
                <div style={{ marginTop: 32 }}>
                  <h3 style={{ color: "#fff", fontSize: 16, fontWeight: 700, marginBottom: 16,
                    display: "flex", alignItems: "center", gap: 8 }}>
                    <span style={{ width: 3, height: 16, background: "#e50914", borderRadius: 2, display: "inline-block" }}/>
                    Episodes ¬∑ Season {season}
                  </h3>
                  <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                    {episodes.slice(0, 12).map(ep => (
                      <div key={ep.episode_number} className="ep-row"
                        onClick={() => { setEpisode(ep.episode_number); onPlay(media, type, season, ep.episode_number); }}
                        style={{
                          display: "flex", gap: 14, alignItems: "center", padding: "12px 16px",
                          background: "rgba(255,255,255,0.04)", border: "1px solid rgba(255,255,255,0.06)",
                          borderRadius: 10, cursor: "pointer",
                        }}>
                        {ep.still_path && (
                          <img src={IMG(ep.still_path, "w185")} alt="" style={{
                            width: 100, aspectRatio: "16/9", objectFit: "cover", borderRadius: 6, flexShrink: 0 }} />
                        )}
                        <div style={{ flex: 1 }}>
                          <div style={{ color: "#fff", fontSize: 13, fontWeight: 600, marginBottom: 4 }}>
                            {ep.episode_number}. {ep.name}
                          </div>
                          {ep.overview && (
                            <div style={{ color: "#666", fontSize: 12, lineHeight: 1.5,
                              display: "-webkit-box", WebkitLineClamp: 2, WebkitBoxOrient: "vertical", overflow: "hidden" }}>
                              {ep.overview}
                            </div>
                          )}
                        </div>
                        <div style={{
                          width: 32, height: 32, borderRadius: "50%",
                          background: "rgba(229,9,20,0.15)", border: "1px solid rgba(229,9,20,0.3)",
                          display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0,
                        }}>
                          <svg width="10" height="10" viewBox="0 0 24 24" fill="#e50914"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    /* ‚îÄ‚îÄ Search Results ‚îÄ‚îÄ */
    function SearchResults({ query, results, onPlay, onInfo }) {
      return (
        <div style={{ padding: "100px 48px 48px" }}>
          <h2 style={{ color: "#fff", fontSize: 22, fontWeight: 700, marginBottom: 8, display: "flex", alignItems: "center", gap: 10 }}>
            <span style={{ width: 3, height: 22, background: "#e50914", borderRadius: 2, display: "inline-block" }}/>
            Results for "{query}"
          </h2>
          <p style={{ color: "#555", fontSize: 13, marginBottom: 32 }}>{results.length} title{results.length !== 1 ? "s" : ""} found</p>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(160px, 1fr))", gap: 20 }}>
            {results.map(item => (
              <MediaCard key={item.id} item={item} onPlay={onPlay} onInfo={onInfo}
                type={item.first_air_date ? "tv" : "movie"} />
            ))}
          </div>
        </div>
      );
    }

    /* ‚îÄ‚îÄ Anime Tab ‚îÄ‚îÄ */
    function AnimeTab({ onPlay }) {
      const ANIME = [
        { id: 5114,  title: "Fullmetal Alchemist: Brotherhood", eps: 64,   year: 2009, rating: 9.1 },
        { id: 1535,  title: "Death Note",                       eps: 37,   year: 2006, rating: 8.6 },
        { id: 16498, title: "Attack on Titan",                  eps: 87,   year: 2013, rating: 9.0 },
        { id: 5,     title: "Cowboy Bebop",                     eps: 26,   year: 1998, rating: 8.8 },
        { id: 21,    title: "One Piece",                        eps: 1000, year: 1999, rating: 8.7 },
        { id: 20,    title: "Naruto",                           eps: 220,  year: 2002, rating: 8.3 },
        { id: 38000, title: "Demon Slayer",                     eps: 26,   year: 2019, rating: 8.7 },
        { id: 40748, title: "Jujutsu Kaisen",                   eps: 24,   year: 2020, rating: 8.6 },
        { id: 35760, title: "My Hero Academia",                 eps: 113,  year: 2016, rating: 8.2 },
        { id: 38524, title: "Steins;Gate",                      eps: 24,   year: 2011, rating: 9.1 },
        { id: 33486, title: "Mob Psycho 100",                   eps: 25,   year: 2016, rating: 8.8 },
        { id: 37521, title: "Haikyuu!!",                        eps: 85,   year: 2014, rating: 8.7 },
      ];
      const [sel, setSel] = useState(null);
      const [ep, setEp] = useState(1);
      const [dubSub, setDubSub] = useState("sub");

      return (
        <div style={{ padding: "100px 48px 48px" }}>
          {sel ? (
            <div style={{ background: "#141418", border: "1px solid rgba(255,255,255,0.08)", borderRadius: 20, padding: 32, maxWidth: 600 }}>
              <button onClick={() => setSel(null)} style={{
                background: "transparent", border: "none", color: "#888", cursor: "pointer",
                fontSize: 14, marginBottom: 20, display: "flex", alignItems: "center", gap: 6,
              }}>‚Üê Back to Anime</button>
              <h2 style={{ color: "#fff", fontFamily: "'Bebas Neue', cursive", fontSize: 36, letterSpacing: 3, marginBottom: 8 }}>{sel.title}</h2>
              <p style={{ color: "#888", fontSize: 13, marginBottom: 24 }}>{sel.eps} episodes ¬∑ {sel.year} ¬∑ ‚òÖ {sel.rating}</p>
              <div style={{ display: "flex", gap: 14, alignItems: "flex-end", flexWrap: "wrap", marginBottom: 24 }}>
                <div>
                  <label style={{ color: "#666", fontSize: 11, textTransform: "uppercase", letterSpacing: 1, display: "block", marginBottom: 6 }}>Episode</label>
                  <input type="number" min={1} max={sel.eps} value={ep}
                    onChange={e => setEp(Math.max(1, parseInt(e.target.value) || 1))}
                    style={{ background: "#1a1a2e", border: "1px solid rgba(255,255,255,0.1)", borderRadius: 8,
                      padding: "10px 14px", color: "#fff", fontSize: 14, width: 100 }} />
                </div>
                <div>
                  <label style={{ color: "#666", fontSize: 11, textTransform: "uppercase", letterSpacing: 1, display: "block", marginBottom: 6 }}>Type</label>
                  <div style={{ display: "flex", gap: 6 }}>
                    {["sub","dub"].map(t => (
                      <button key={t} onClick={() => setDubSub(t)} style={{
                        background: dubSub === t ? "rgba(229,9,20,0.2)" : "rgba(255,255,255,0.06)",
                        border: dubSub === t ? "1px solid rgba(229,9,20,0.5)" : "1px solid rgba(255,255,255,0.1)",
                        borderRadius: 8, padding: "10px 20px",
                        color: dubSub === t ? "#fff" : "#888", cursor: "pointer",
                        textTransform: "uppercase", fontSize: 12, fontWeight: 700,
                      }}>{t}</button>
                    ))}
                  </div>
                </div>
                <button className="play-btn" onClick={() => onPlay({ id: sel.id, title: sel.title }, "anime", ep, dubSub)} style={{
                  background: "#e50914", border: "none", borderRadius: 10, padding: "11px 28px",
                  color: "#fff", fontWeight: 700, fontSize: 14, cursor: "pointer",
                  display: "flex", alignItems: "center", gap: 8,
                  boxShadow: "0 0 20px rgba(229,9,20,0.3)",
                }}>
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="white"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                  Watch
                </button>
              </div>
            </div>
          ) : (
            <>
              <h2 style={{ color: "#fff", fontSize: 22, fontWeight: 700, marginBottom: 8, display: "flex", alignItems: "center", gap: 10 }}>
                <span style={{ width: 3, height: 22, background: "#e50914", borderRadius: 2, display: "inline-block" }}/>
                Anime Collection
              </h2>
              <p style={{ color: "#555", fontSize: 13, marginBottom: 32 }}>Powered by MyAnimeList ¬∑ Sub &amp; Dub available</p>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(220px, 1fr))", gap: 16 }}>
                {ANIME.map(a => (
                  <div key={a.id} className="anime-card" onClick={() => setSel(a)} style={{
                    background: "#141418", border: "1px solid rgba(255,255,255,0.07)",
                    borderRadius: 14, padding: 20, cursor: "pointer",
                  }}>
                    <div style={{ fontWeight: 700, color: "#fff", fontSize: 14, marginBottom: 8, lineHeight: 1.3 }}>{a.title}</div>
                    <div style={{ display: "flex", gap: 8, flexWrap: "wrap", marginBottom: 12 }}>
                      <span style={{ color: "#ffc107", fontSize: 12 }}>‚òÖ {a.rating}</span>
                      <span style={{ color: "#666", fontSize: 12 }}>{a.eps} eps</span>
                      <span style={{ color: "#666", fontSize: 12 }}>{a.year}</span>
                    </div>
                    <div style={{ display: "inline-flex", alignItems: "center", gap: 5,
                      background: "rgba(229,9,20,0.1)", border: "1px solid rgba(229,9,20,0.2)",
                      borderRadius: 6, padding: "4px 10px", color: "#e50914", fontSize: 11, fontWeight: 700 }}>
                      <svg width="8" height="8" viewBox="0 0 24 24" fill="#e50914"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                      Watch
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>
      );
    }

    /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
    function Spinner() {
      return (
        <div style={{ display: "flex", alignItems: "center", justifyContent: "center",
          height: "100vh", flexDirection: "column", gap: 16 }}>
          <div style={{
            width: 48, height: 48,
            border: "3px solid rgba(229,9,20,0.2)",
            borderTop: "3px solid #e50914",
            borderRadius: "50%",
            animation: "spin 0.8s linear infinite",
          }}/>
          <div style={{ color: "#666", fontSize: 13 }}>Loading titles...</div>
        </div>
      );
    }

    /* ‚îÄ‚îÄ App ‚îÄ‚îÄ */
    function App() {
      const [activeTab, setActiveTab] = useState("Movies");
      const [query, setQuery] = useState("");
      const [searchResults, setSearchResults] = useState([]);
      const [rows, setRows] = useState({});
      const [hero, setHero] = useState([]);
      const [player, setPlayer] = useState(null);
      const [detail, setDetail] = useState(null);
      const [scrolled, setScrolled] = useState(false);
      const [loading, setLoading] = useState(true);
      const searchTimeout = useRef(null);

      useEffect(() => {
        const fn = () => setScrolled(window.scrollY > 60);
        window.addEventListener("scroll", fn);
        return () => window.removeEventListener("scroll", fn);
      }, []);

      useEffect(() => {
        setLoading(true);
        setRows({});
        setHero([]);

        const fetchMovies = async () => {
          const [trending, popular, topRated, upcoming, action, scifi, horror, comedy, drama] =
            await Promise.all([
              tmdb("/trending/movie/week"),
              tmdb("/movie/popular"),
              tmdb("/movie/top_rated"),
              tmdb("/movie/upcoming"),
              tmdb("/discover/movie?with_genres=28&sort_by=popularity.desc"),
              tmdb("/discover/movie?with_genres=878&sort_by=popularity.desc"),
              tmdb("/discover/movie?with_genres=27&sort_by=popularity.desc"),
              tmdb("/discover/movie?with_genres=35&sort_by=popularity.desc"),
              tmdb("/discover/movie?with_genres=18&sort_by=vote_count.desc"),
            ]);
          setHero((trending.results || []).slice(0, 6));
          setRows({
            "üî• Trending This Week":  trending.results  || [],
            "üåü Popular Now":          popular.results   || [],
            "üèÜ Top Rated All Time":   topRated.results  || [],
            "üé¨ Coming Soon":          upcoming.results  || [],
            "‚ö° Action & Adventure":   action.results    || [],
            "üöÄ Science Fiction":      scifi.results     || [],
            "üò± Horror":               horror.results    || [],
            "üòÇ Comedy":               comedy.results    || [],
            "‚ù§Ô∏è Drama":                drama.results     || [],
          });
          setLoading(false);
        };

        const fetchTV = async () => {
          const [trending, popular, topRated, drama, crime, scifi, anim] = await Promise.all([
            tmdb("/trending/tv/week"),
            tmdb("/tv/popular"),
            tmdb("/tv/top_rated"),
            tmdb("/discover/tv?with_genres=18&sort_by=popularity.desc"),
            tmdb("/discover/tv?with_genres=80&sort_by=popularity.desc"),
            tmdb("/discover/tv?with_genres=10765&sort_by=popularity.desc"),
            tmdb("/discover/tv?with_genres=16&sort_by=vote_average.desc&vote_count.gte=100"),
          ]);
          setHero((trending.results || []).slice(0, 6));
          setRows({
            "üî• Trending This Week": trending.results || [],
            "‚≠ê Popular Shows":       popular.results  || [],
            "üèÜ Top Rated":          topRated.results || [],
            "üé≠ Drama":              drama.results    || [],
            "üî™ Crime & Thriller":   crime.results    || [],
            "üõ∏ Sci-Fi & Fantasy":   scifi.results    || [],
            "üå∏ Animation":          anim.results     || [],
          });
          setLoading(false);
        };

        if (activeTab === "Movies") fetchMovies().catch(console.error);
        else if (activeTab === "TV Shows") fetchTV().catch(console.error);
        else setLoading(false);
      }, [activeTab]);

      useEffect(() => {
        if (!query) { setSearchResults([]); return; }
        clearTimeout(searchTimeout.current);
        searchTimeout.current = setTimeout(async () => {
          const r = await tmdb(`/search/multi?query=${encodeURIComponent(query)}&include_adult=false`);
          setSearchResults((r.results || []).filter(i => i.poster_path));
        }, 400);
        return () => clearTimeout(searchTimeout.current);
      }, [query]);

      const handlePlay = (item, type, season = 1, episode = 1) => {
        setDetail(null);
        setPlayer({ media: item, type: type || (item.first_air_date ? "tv" : "movie"), season, episode });
      };

      const handleInfo = (item, type) => {
        setDetail({ media: item, type: type || (item.first_air_date ? "tv" : "movie") });
      };

      if (player) return (
        <PlayerModal media={player.media} type={player.type}
          season={player.season} episode={player.episode}
          onClose={() => setPlayer(null)} />
      );

      return (
        <div style={{ minHeight: "100vh", background: "#0a0a0f" }}>
          <Navbar query={query} setQuery={setQuery} activeTab={activeTab}
            setActiveTab={t => { setActiveTab(t); setQuery(""); }} scrolled={scrolled} />

          {query && searchResults.length > 0 ? (
            <SearchResults query={query} results={searchResults} onPlay={handlePlay} onInfo={handleInfo} />
          ) : activeTab === "Anime" ? (
            <AnimeTab onPlay={handlePlay} onInfo={handleInfo} />
          ) : loading ? (
            <Spinner />
          ) : (
            <>
              {hero.length > 0 && <Hero items={hero} onPlay={handlePlay} onInfo={handleInfo} />}
              <div style={{ paddingBottom: 60, marginTop: hero.length ? -20 : 80 }}>
                {Object.entries(rows).map(([title, items]) => (
                  <MediaRow key={title} title={title} items={items}
                    onPlay={handlePlay} onInfo={handleInfo}
                    type={activeTab === "TV Shows" ? "tv" : "movie"} />
                ))}
              </div>
              <div style={{ textAlign: "center", padding: 32, borderTop: "1px solid rgba(255,255,255,0.04)" }}>
                <div style={{ fontFamily: "'Bebas Neue', cursive", fontSize: 22, letterSpacing: 4, color: "rgba(255,255,255,0.15)" }}>
                  STREAM<span style={{ color: "rgba(229,9,20,0.35)" }}>VAULT</span>
                </div>
                <p style={{ color: "#333", fontSize: 11, marginTop: 8 }}>Powered by TMDB ¬∑ VidLink ¬∑ ¬© 2025</p>
              </div>
            </>
          )}

          {detail && (
            <DetailModal media={detail.media} type={detail.type}
              onPlay={handlePlay} onClose={() => setDetail(null)} />
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
